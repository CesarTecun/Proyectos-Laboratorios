<div class="container my-4">
  <!-- Header -->
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h2 class="h4 mb-1">Clientes</h2>
      <p class="text-muted mb-0">Listado de personas registradas en el sistema.</p>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-outline-secondary" (click)="reload()" [disabled]="isLoading()">
        <span class="spinner-border spinner-border-sm me-1" *ngIf="isLoading()"></span>
        Recargar
      </button>
    </div>
  </div>

  <!-- Barra de herramientas -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-2 align-items-center">
        <div class="col-12 col-md-6">
          <label for="search" class="form-label mb-1">Buscar</label>
          <input id="search" type="text" class="form-control"
                placeholder="Filtra por nombre, apellido o correo…"
                [(ngModel)]="query"
                (ngModelChange)="goToPage(1)">
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label mb-1">Ordenar por</label>
          <select class="form-select" [(ngModel)]="sortKey" (change)="goToPage(1)">
            <option value="id">ID</option>
            <option value="firstName">Nombre</option>
            <option value="lastName">Apellido</option>
            <option value="email">Correo</option>
            <option value="createdAt">Creado</option>
          </select>
        </div>
        <div class="col-6 col-md-3">
          <label class="form-label mb-1">Dirección</label>
          <div class="btn-group d-flex" role="group" aria-label="Dirección de ordenamiento">
            <button class="btn btn-outline-primary" [class.active]="sortDir==='asc'" (click)="setDir('asc')">Asc</button>
            <button class="btn btn-outline-primary" [class.active]="sortDir==='desc'" (click)="setDir('desc')">Desc</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Alertas de error -->
  <div class="alert alert-danger d-flex align-items-center" *ngIf="error()">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <div>{{ error() }}</div>
  </div>

  <!-- Tabla -->
  <div class="card">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Nombre</th>
            <th scope="col">Correo</th>
            <th scope="col" class="text-nowrap">Creado</th>
          </tr>
        </thead>

        <!-- Loading skeleton -->
        <tbody *ngIf="isLoading()">
          <tr *ngFor="let _ of [1,2,3,4,5]">
            <td colspan="4">
              <div class="placeholder-glow">
                <span class="placeholder col-2 me-2"></span>
                <span class="placeholder col-3 me-2"></span>
                <span class="placeholder col-4 me-2"></span>
                <span class="placeholder col-2"></span>
              </div>
            </td>
          </tr>
        </tbody>

        <!-- Datos -->
        <tbody *ngIf="!isLoading() && paged().length > 0">
          <tr *ngFor="let p of paged()">
            <td>{{ p.id }}</td>
            <td class="fw-medium">{{ p.firstName }} {{ p.lastName }}</td>
            <td>
              <a *ngIf="p.email; else noEmail" [href]="'mailto:'+p.email">{{ p.email }}</a>
              <ng-template #noEmail>—</ng-template>
            </td>
            <td class="text-muted text-nowrap">{{ p.createdAt ? (p.createdAt | date:'medium') : '—' }}</td>
          </tr>
        </tbody>

        <!-- Vacío -->
        <tbody *ngIf="!isLoading() && paged().length === 0">
          <tr>
            <td colspan="4" class="text-center py-4 text-muted">
              No se encontraron resultados.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginación -->
    <div class="card-footer d-flex flex-wrap align-items-center gap-2 justify-content-between">
      <div class="text-muted small">
        Mostrando {{ startIndex()+1 }}–{{ endIndex() }} de {{ filtered().length }}
      </div>
      <div class="d-flex align-items-center gap-2">
        <select class="form-select form-select-sm w-auto" [(ngModel)]="pageSize" (ngModelChange)="goToPage(1)">
          <option [ngValue]="5">5</option>
          <option [ngValue]="10">10</option>
          <option [ngValue]="25">25</option>
        </select>
        <div class="btn-group" role="group" aria-label="Paginación">
          <button class="btn btn-outline-secondary btn-sm" (click)="prevPage()" [disabled]="page===1">«</button>
          <span class="btn btn-outline-secondary btn-sm disabled">Página {{ page }} / {{ totalPages() || 1 }}</span>
          <button class="btn btn-outline-secondary btn-sm" (click)="nextPage()" [disabled]="page>=totalPages()">»</button>
        </div>
      </div>
    </div>
  </div>
</div>
